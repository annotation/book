
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compose &#8212; Corpus computing with Text-Fabric</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/tf-small.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="The Banks example corpus as app" href="app.html" />
    <link rel="prev" title="Introduction" href="../intro.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/tf.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Corpus computing with Text-Fabric</h1>
  
</a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Banks (mini corpus)
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Compose
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="app.html">
   The Banks example corpus as app
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="repo.html">
   Getting data from online repos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="use.html">
   Use the Banks example corpus
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="share.html">
   Share the Banks example corpus
  </a>
 </li>
</ul>
<p class="caption collapsible-parent">
 <span class="caption-text">
  Uruk Proto-cuneiform Tablets
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/start.html">
   Start
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/imagery.html">
   Imagery
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/search.html">
   Search
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/relation.html">
   Relation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/quantifier.html">
   Quantifiers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/hand.html">
   Hand-coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/steps.html">
   Steps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/jumps.html">
   Jumps
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/signs.html">
   Signs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/quads.html">
   Quads
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../uruk/cases.html">
   Cases
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/banks/compose.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/annotation/book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/annotation/book/issues/new?title=Issue%20on%20page%20%2Fbanks/compose.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/annotation/book/master?urlpath=lab/tree/banks/compose.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#corpus">
   Corpus
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#combine">
   Combine
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#result">
   Result
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#the-merging-principle">
     The merging principle
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modify">
   Modify
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#only-meta-data">
     Only meta data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merge-features">
     Merge features
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#delete-features">
     Delete features
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id3">
       Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-features">
     Add features
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id4">
       Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#merge-types">
     Merge types
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id5">
       Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#delete-types">
     Delete types
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id6">
       Result
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#add-types">
     Add types
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id7">
       Result
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <a class="reference internal image-reference" href="../_images/tf-small.png"><img alt="../_images/tf-small.png" class="align-right" src="../_images/tf-small.png" style="width: 128px;" /></a>
<hr class="docutils" />
<p>Start with <a class="reference external" href="https://nbviewer.jupyter.org/github/annotation/banks/blob/master/programs/convert.ipynb">convert</a></p>
<hr class="docutils" />
<div class="section" id="compose">
<h1>Compose<a class="headerlink" href="#compose" title="Permalink to this headline">¶</a></h1>
<p>This is about combining multiple TF datasets into one, and then tweaking it further.</p>
<p>In the previous chapters of this tutorial you have learned how to add new features to an existing dataset.</p>
<p>Here you learn how you can combine dozens of slightly heterogeneous TF data sets,
and apply structural tweaks to the node types and features later on.</p>
<p>The incentive to write these composition functions into Text-Fabric came from Ernst Boogert while he was
converting between 100 and 200 works by the Church Fathers (Patristics).
The conversion did a very good job in getting all the information from TEI files with different structures into TF,
one dataset per work.</p>
<p>Then the challenge became to combine them into one big dataset, and to merge several node types into one type,
and several features into one.</p>
<p>See <a class="reference external" href="https://github.com/pthu/patristics">patristics</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<p>The new functions are <code class="docutils literal notranslate"><span class="pre">combine()</span></code> and <code class="docutils literal notranslate"><span class="pre">modify()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tf.fabric</span> <span class="kn">import</span> <span class="n">Fabric</span>
<span class="kn">from</span> <span class="nn">tf.compose</span> <span class="kn">import</span> <span class="n">combine</span><span class="p">,</span> <span class="n">modify</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="corpus">
<h2>Corpus<a class="headerlink" href="#corpus" title="Permalink to this headline">¶</a></h2>
<p>We use two copies of our example corpus Banks, present in this repository.</p>
</div>
<div class="section" id="combine">
<h2>Combine<a class="headerlink" href="#combine" title="Permalink to this headline">¶</a></h2>
<p>The combine function takes any number of directory locations, and considers each location to be the
host of a TF data set.</p>
<p>You can pass this list straight to the <code class="docutils literal notranslate"><span class="pre">combine()</span></code> function as the <code class="docutils literal notranslate"><span class="pre">locations</span></code> parameter,
or you can add names to the individual corpora.
In that case, you pass an iterable of (<code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">location</span></code>) pairs into the <code class="docutils literal notranslate"><span class="pre">locations</span></code> parameter.</p>
<p>Here we give the first copy the name <code class="docutils literal notranslate"><span class="pre">banks</span></code>, and the second copy the name <code class="docutils literal notranslate"><span class="pre">river</span></code>.</p>
<p>We also specify the output location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">PREFIX</span> <span class="o">=</span> <span class="s1">&#39;combine/input&#39;</span>
<span class="n">SUFFIX</span> <span class="o">=</span> <span class="s1">&#39;tf/0.2&#39;</span>

<span class="n">locations</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;banks&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PREFIX</span><span class="si">}</span><span class="s1">/banks1/</span><span class="si">{</span><span class="n">SUFFIX</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;rivers&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PREFIX</span><span class="si">}</span><span class="s1">/banks2/</span><span class="si">{</span><span class="n">SUFFIX</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">COMBINED</span> <span class="o">=</span> <span class="s1">&#39;combine/_temp/riverbanks&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>We are going to call the <code class="docutils literal notranslate"><span class="pre">combine()</span></code> function.</p>
<p>But first we clear the output location.</p>
<p>Note how you can mix a bash-shell command with your Python code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">COMBINED</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">combine</span><span class="p">(</span>
  <span class="n">locations</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">componentType</span><span class="o">=</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span>
  <span class="n">componentFeature</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
  <span class="n">featureMeta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">otext</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">sectionTypes</span><span class="o">=</span><span class="s1">&#39;volume,chapter,line&#39;</span><span class="p">,</span>
      <span class="n">sectionFeatures</span><span class="o">=</span><span class="s1">&#39;title,number,number&#39;</span><span class="p">,</span>
      <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fmt:text-orig-full&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{letters}</span><span class="s1"> &#39;</span><span class="p">},</span>
    <span class="p">),</span>
  <span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s inspect metadata ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is Text-Fabric 8.4.6
Api reference : https://annotation.github.io/text-fabric/cheatsheet.html
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 features found and 0 ignored
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is Text-Fabric 8.4.6
Api reference : https://annotation.github.io/text-fabric/cheatsheet.html
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 features found and 0 ignored
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: otext.structureFeatures metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: otext.structureTypes metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: author.compiler metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: author.purpose metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: letters.description metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.01s determine nodetypes ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s 
  1 0.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is Text-Fabric 8.4.6
Api reference : https://annotation.github.io/text-fabric/cheatsheet.html
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 features found and 0 ignored
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s loading features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.01s All features loaded/computed - for details use loadLog()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.01s 
  2 0.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is Text-Fabric 8.4.6
Api reference : https://annotation.github.io/text-fabric/cheatsheet.html
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 features found and 0 ignored
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s loading features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.01s All features loaded/computed - for details use loadLog()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |   
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.02s done
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.02s compute offsets ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.02s remap features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s 
  1 0.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is Text-Fabric 8.4.6
Api reference : https://annotation.github.io/text-fabric/cheatsheet.html
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 features found and 0 ignored
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s loading features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.01s All features loaded/computed - for details use loadLog()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s loading features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s All additional features loaded - for details use loadLog()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.01s 
  2 0.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is Text-Fabric 8.4.6
Api reference : https://annotation.github.io/text-fabric/cheatsheet.html
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 features found and 0 ignored
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s loading features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.01s All features loaded/computed - for details use loadLog()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s loading features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s All additional features loaded - for details use loadLog()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.03s write TF data ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.03s done
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>This function is a bit verbose in its output, but a lot happens under the hood, and if your dataset is large,
it may take several minutes. It is pleasant to see the progress under those circumstances.</p>
<p>But for now, we pass <code class="docutils literal notranslate"><span class="pre">silent=True</span></code>, to make everything a bit more quiet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">COMBINED</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">combine</span><span class="p">(</span>
  <span class="n">locations</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">componentType</span><span class="o">=</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span>
  <span class="n">componentFeature</span><span class="o">=</span><span class="s1">&#39;title&#39;</span><span class="p">,</span>
  <span class="n">featureMeta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">otext</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">sectionTypes</span><span class="o">=</span><span class="s1">&#39;volume,chapter,line&#39;</span><span class="p">,</span>
      <span class="n">sectionFeatures</span><span class="o">=</span><span class="s1">&#39;title,number,number&#39;</span><span class="p">,</span>
      <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fmt:text-orig-full&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{letters}</span><span class="s1"> &#39;</span><span class="p">},</span>
    <span class="p">),</span>
  <span class="p">),</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: otext.structureFeatures metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: otext.structureTypes metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: author.compiler metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: author.purpose metadata varies across sources
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: letters.description metadata varies across sources
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>There you are, on your file system you see the combined dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls  -l <span class="o">{</span>output<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>total 80
-rw-r--r--  1 dirk  staff   638 Jan  5 13:04 author.tf
-rw-r--r--  1 dirk  staff   597 Jan  5 13:04 gap.tf
-rw-r--r--  1 dirk  staff  1692 Jan  5 13:04 letters.tf
-rw-r--r--  1 dirk  staff   621 Jan  5 13:04 number.tf
-rw-r--r--  1 dirk  staff   754 Jan  5 13:04 oslots.tf
-rw-r--r--  1 dirk  staff  1135 Jan  5 13:04 otext.tf
-rw-r--r--  1 dirk  staff   558 Jan  5 13:04 otype.tf
-rw-r--r--  1 dirk  staff   713 Jan  5 13:04 punc.tf
-rw-r--r--  1 dirk  staff   567 Jan  5 13:04 terminator.tf
-rw-r--r--  1 dirk  staff   636 Jan  5 13:04 title.tf
</pre></div>
</div>
</div>
</div>
<p>If we compare that with one of the input:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls -l <span class="o">{</span>PREFIX<span class="o">}</span>/banks1/<span class="o">{</span>SUFFIX<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>total 80
-rw-r--r--  1 dirk  staff  359 May 20  2019 author.tf
-rw-r--r--  1 dirk  staff  409 May 20  2019 gap.tf
-rw-r--r--  1 dirk  staff  911 May 20  2019 letters.tf
-rw-r--r--  1 dirk  staff  421 May 20  2019 number.tf
-rw-r--r--  1 dirk  staff  419 May 20  2019 oslots.tf
-rw-r--r--  1 dirk  staff  572 May 20  2019 otext.tf
-rw-r--r--  1 dirk  staff  372 May 30  2019 otype.tf
-rw-r--r--  1 dirk  staff  457 May 20  2019 punc.tf
-rw-r--r--  1 dirk  staff  377 May 20  2019 terminator.tf
-rw-r--r--  1 dirk  staff  361 May 20  2019 title.tf
</pre></div>
</div>
</div>
</div>
<p>then we see the same sizes but smaller file sizes.</p>
</div>
<div class="section" id="result">
<h2>Result<a class="headerlink" href="#result" title="Permalink to this headline">¶</a></h2>
<p>Let’s have a look inside, and note that we use the new TF function <code class="docutils literal notranslate"><span class="pre">loadAll()</span></code>
which loads all loadable features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TF</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="n">COMBINED</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">loadAll</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">makeAvailableIn</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>This is Text-Fabric 8.4.6
Api reference : https://annotation.github.io/text-fabric/cheatsheet.html
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10 features found and 0 ignored
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s loading features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T otype                from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T oslots               from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s Dataset without structure sections in otext:no structure functions in the T-API
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T terminator           from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T letters              from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T gap                  from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T title                from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T punc                 from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T number               from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levels__           from otype, oslots, otext
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __order__            from otype, oslots, __levels__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __rank__             from otype, __order__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levUp__            from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levDown__          from otype, __levUp__, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __boundary__         from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __sections__         from otype, oslots, otext, __levUp__, __levels__, title, number, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.03s All features loaded/computed - for details use loadLog()
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s loading features ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T author               from combine/_temp/riverbanks
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0.00s All additional features loaded - for details use loadLog()
</pre></div>
</div>
</div>
</div>
<p>We look up the section of the first word:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">.</span><span class="n">sectionFromNode</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;banks&#39;, 1, 1)
</pre></div>
</div>
</div>
</div>
<p>The component sets had 99 words each. So what is the section of word 100?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">.</span><span class="n">sectionFromNode</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;rivers&#39;, 1, 1)
</pre></div>
</div>
</div>
</div>
<p>Right, that’s the first word of the second component.</p>
<p>Here is an overview of all the node types in the combined set.</p>
<p>The second field is the average length in words for nodes of that type, the remaining fields give
the first and last node of that type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((&#39;book&#39;, 99.0, 199, 200),
 (&#39;volume&#39;, 99.0, 235, 236),
 (&#39;chapter&#39;, 49.5, 201, 204),
 (&#39;sentence&#39;, 33.0, 229, 234),
 (&#39;line&#39;, 7.666666666666667, 205, 228),
 (&#39;word&#39;, 1, 1, 198))
</pre></div>
</div>
</div>
</div>
<p>The combined data set consists of the concatenation of all slot nodes of the component data sets.</p>
<p>Note that the individual components have got a top node, of type <code class="docutils literal notranslate"><span class="pre">volume</span></code>.
This is the effect of specifying <code class="docutils literal notranslate"><span class="pre">componentType='volume'</span></code>.</p>
<p>There is also a feature for volumes, named <code class="docutils literal notranslate"><span class="pre">title</span></code>, that contains their name, or if we haven’t passed their names
in the <code class="docutils literal notranslate"><span class="pre">locations</span></code> parameter, their location.
This is the effect of <code class="docutils literal notranslate"><span class="pre">componentFeature='title'</span></code>.</p>
<p>Let’s check.</p>
<p>We use the new <code class="docutils literal notranslate"><span class="pre">.items()</span></code> method on features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_items([(199, &#39;Consider Phlebas&#39;), (200, &#39;Consider Phlebas&#39;), (235, &#39;banks&#39;), (236, &#39;rivers&#39;)])
</pre></div>
</div>
</div>
</div>
<p>We see several things:</p>
<ul class="simple">
<li><p>the volume nodes indeed got the component name in the feature <code class="docutils literal notranslate"><span class="pre">title</span></code></p></li>
<li><p>the other nodes that already had a title, the <code class="docutils literal notranslate"><span class="pre">book</span></code> nodes, still have the same value for <code class="docutils literal notranslate"><span class="pre">title</span></code> as before.</p></li>
</ul>
<div class="section" id="the-merging-principle">
<h3>The merging principle<a class="headerlink" href="#the-merging-principle" title="Permalink to this headline">¶</a></h3>
<p>This is a general principle that we see over and over again: when we combine data, we merge as much as possible.</p>
<p>That means that when you  create new features, you may use the names of old features, and the new information for that
feature will be merged with the old information of that feature.</p>
</div>
</div>
<div class="section" id="modify">
<h2>Modify<a class="headerlink" href="#modify" title="Permalink to this headline">¶</a></h2>
<p>Although combining has its complications, the most complex operation is <code class="docutils literal notranslate"><span class="pre">modify()</span></code> because it can do many things.</p>
<p>It operates on a single TF dataset, and it produces a modified dataset as a fresh “copy”.</p>
<p>Despite the name, no actual modification takes place on the input dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">location</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">PREFIX</span><span class="si">}</span><span class="s1">/banks1/</span><span class="si">{</span><span class="n">SUFFIX</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">MODIFIED</span> <span class="o">=</span> <span class="s1">&#39;_temp/mudbanks&#39;</span>
</pre></div>
</div>
</div>
</div>
<p>Now we take the first local copy of the Banks dataset as  our input, for a lot of different operations.</p>
<p>Here is the list what <code class="docutils literal notranslate"><span class="pre">modify()</span></code> can do.
The order is important, because all operations are executed in this order:</p>
<ol class="simple">
<li><p><strong>merge features</strong>: several input features are combined into a single output feature and then deleted;</p></li>
<li><p><strong>delete features</strong>: several features are be deleted</p></li>
<li><p><strong>add features</strong>: several node/edge features with their data are added to the dataset</p></li>
<li><p><strong>merge types</strong>: several input node types are combined into a single output node type;
the input nodetypes are deleted, but not their nodes: they are now part of the output node type;</p></li>
<li><p><strong>delete types</strong>: several node types are deleted, <em>with their nodes</em>, and all features
will be remapped to accomodate for this;</p></li>
<li><p><strong>add types</strong>: several new node types with additional feature data for them are added after the last node;
features do not have to be remapped for this; the new node types may be arbitrary intervals of integers and
have no relationship with the existing nodes.</p></li>
<li><p><strong>modify metadata</strong>: the metadata of all features can be tweaked, including everything that is in the
<code class="docutils literal notranslate"><span class="pre">otext</span></code> feature, such as text formats and section structure definitions.</p></li>
</ol>
<p>Modify will perform as many sanity checks as possible before it starts working, so that the chances are good that
the modified dataset will load properly.
It will adapt the value type of features to the values encountered, and it will deduce whether edges have values or not.</p>
<p>If a modified dataset does not load, while the original dataset did load, it is a bug, and I welcome a
<a class="reference external" href="https://github.com/annotation/text-fabric/issues">GitHub issue</a>
for it.</p>
<div class="section" id="only-meta-data">
<h3>Only meta data<a class="headerlink" href="#only-meta-data" title="Permalink to this headline">¶</a></h3>
<p>We start with the last one, the most simple one.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">otext</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">sectionTypes</span><span class="o">=</span><span class="s1">&#39;book,chapter&#39;</span><span class="p">,</span>
    <span class="n">sectionFeatures</span><span class="o">=</span><span class="s1">&#39;title,number&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="p">{</span><span class="s1">&#39;fmt:text-orig-full&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{letters}</span><span class="s1"> &#39;</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We use <code class="docutils literal notranslate"><span class="pre">silent=True</span></code> from now on, but if you work with larger datasets, it is recommended to set <code class="docutils literal notranslate"><span class="pre">silent=False</span></code> or
to leave it out altogether.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;meta&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">featureMeta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">otext</span><span class="o">=</span><span class="n">otext</span><span class="p">),</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h4>Result<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TF</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">loadAll</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">makeAvailableIn</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T otype                from _temp/mudbanks.meta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T oslots               from _temp/mudbanks.meta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T title                from _temp/mudbanks.meta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T letters              from _temp/mudbanks.meta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T terminator           from _temp/mudbanks.meta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T number               from _temp/mudbanks.meta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levels__           from otype, oslots, otext
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __order__            from otype, oslots, __levels__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __rank__             from otype, __order__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levUp__            from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levDown__          from otype, __levUp__, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __boundary__         from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __sections__         from otype, oslots, otext, __levUp__, __levels__, title, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __structure__        from otype, oslots, otext, __rank__, __levUp__, title, number, number, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T author               from _temp/mudbanks.meta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T gap                  from _temp/mudbanks.meta
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T punc                 from _temp/mudbanks.meta
</pre></div>
</div>
</div>
</div>
<p>We have now only 2 section levels. If we ask for some sections, we see that we only get 2 components in the tuple.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">.</span><span class="n">sectionFromNode</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Consider Phlebas&#39;, 1)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">.</span><span class="n">sectionFromNode</span><span class="p">(</span><span class="mi">99</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&#39;Consider Phlebas&#39;, 2)
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="merge-features">
<h3>Merge features<a class="headerlink" href="#merge-features" title="Permalink to this headline">¶</a></h3>
<p>We are going to do some tricky mergers on features that are involved in the section structure and the
text formats, so we take care to modify those by means of the <code class="docutils literal notranslate"><span class="pre">featureMeta</span></code> parameter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">otext</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">sectionTypes</span><span class="o">=</span><span class="s1">&#39;book,chapter&#39;</span><span class="p">,</span>
    <span class="n">sectionFeatures</span><span class="o">=</span><span class="s1">&#39;heading,heading&#39;</span><span class="p">,</span>
    <span class="n">structureTypes</span><span class="o">=</span><span class="s1">&#39;book,chapter&#39;</span><span class="p">,</span>
    <span class="n">structureFeatures</span><span class="o">=</span><span class="s1">&#39;heading,heading&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="p">{</span>
      <span class="s1">&#39;fmt:text-orig-full&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{content}</span><span class="s1"> &#39;</span><span class="p">,</span>
      <span class="s1">&#39;fmt:text-orig-fake&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="si">{fake}</span><span class="s1"> &#39;</span><span class="p">,</span>
      <span class="s1">&#39;fmt:line-default&#39;</span><span class="p">:</span> <span class="s1">&#39;{content:XXX}</span><span class="si">{terminator}</span><span class="s1"> &#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We want sectional headings in one feature, <code class="docutils literal notranslate"><span class="pre">heading</span></code>, instead of in <code class="docutils literal notranslate"><span class="pre">title</span></code> for books and <code class="docutils literal notranslate"><span class="pre">number</span></code> for chapters.</p>
<p>We also make a <code class="docutils literal notranslate"><span class="pre">content</span></code> feature that gives the <code class="docutils literal notranslate"><span class="pre">letters</span></code> of a word unless there is punctuation: then it gives <code class="docutils literal notranslate"><span class="pre">punc</span></code>.</p>
<p>And we make the opposite: <code class="docutils literal notranslate"><span class="pre">fake</span></code>: it prefers <code class="docutils literal notranslate"><span class="pre">punc</span></code> over <code class="docutils literal notranslate"><span class="pre">letters</span></code>.</p>
<p>Note that <code class="docutils literal notranslate"><span class="pre">punc</span></code> and <code class="docutils literal notranslate"><span class="pre">letters</span></code> will be deleted after the merge as a whole is completed, so that it is indeed
possible for features to be the input of multiple mergers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;merge.f&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">mergeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">heading</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;title number&#39;</span><span class="p">),</span>
    <span class="n">content</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;punc letters&#39;</span><span class="p">),</span>
    <span class="n">fake</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;letters punc&#39;</span><span class="p">)</span>
  <span class="p">),</span>
  <span class="n">featureMeta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">otext</span><span class="o">=</span><span class="n">otext</span><span class="p">,</span>
  <span class="p">),</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="id2">
<h4>Result<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TF</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">loadAll</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">makeAvailableIn</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T otype                from _temp/mudbanks.merge.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T oslots               from _temp/mudbanks.merge.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T terminator           from _temp/mudbanks.merge.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T heading              from _temp/mudbanks.merge.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T fake                 from _temp/mudbanks.merge.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T content              from _temp/mudbanks.merge.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levels__           from otype, oslots, otext
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __order__            from otype, oslots, __levels__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __rank__             from otype, __order__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levUp__            from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levDown__          from otype, __levUp__, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __boundary__         from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __sections__         from otype, oslots, otext, __levUp__, __levels__, heading, heading
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __structure__        from otype, oslots, otext, __rank__, __levUp__, heading, heading
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T author               from _temp/mudbanks.merge.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T gap                  from _temp/mudbanks.merge.f
</pre></div>
</div>
</div>
</div>
<p>We inspect the new <code class="docutils literal notranslate"><span class="pre">heading</span></code> feature for a book and a chapter.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">otype</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="s1">&#39;book&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">F</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Consider Phlebas&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">otype</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="s1">&#39;chapter&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">F</span><span class="o">.</span><span class="n">heading</span><span class="o">.</span><span class="n">v</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;1&#39;
</pre></div>
</div>
</div>
</div>
<p>And here is an overview of all node features: <code class="docutils literal notranslate"><span class="pre">title</span></code> and <code class="docutils literal notranslate"><span class="pre">number</span></code> are gone, together with <code class="docutils literal notranslate"><span class="pre">punc</span></code> and <code class="docutils literal notranslate"><span class="pre">letters</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Fall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;author&#39;, &#39;content&#39;, &#39;fake&#39;, &#39;gap&#39;, &#39;heading&#39;, &#39;otype&#39;, &#39;terminator&#39;]
</pre></div>
</div>
</div>
</div>
<p>We have modified the standard text format, <code class="docutils literal notranslate"><span class="pre">text-orig-full</span></code>. It now uses the <code class="docutils literal notranslate"><span class="pre">content</span></code> feature,
and indeed, we do not see punctuation anymore.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Everything about us everything around us everything we know &#39;
</pre></div>
</div>
</div>
</div>
<p>On the other hand, <code class="docutils literal notranslate"><span class="pre">text-orig-fake</span></code> uses the <code class="docutils literal notranslate"><span class="pre">fake</span></code> feature, and we see that the words in front
of punctuation have disappeared.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;text-orig-fake&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Everything about , everything around , everything we know &#39;
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="delete-features">
<h3>Delete features<a class="headerlink" href="#delete-features" title="Permalink to this headline">¶</a></h3>
<p>We just remove two features from the dataset: <code class="docutils literal notranslate"><span class="pre">author</span></code> and <code class="docutils literal notranslate"><span class="pre">terminator</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;delete.f&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">deleteFeatures</span><span class="o">=</span><span class="s1">&#39;author terminator&#39;</span><span class="p">,</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |   Missing for text API: features: terminator
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>Oops. <code class="docutils literal notranslate"><span class="pre">terminator</span></code> is used in a text-format, so if we delete it, the dataset will not load properly.</p>
<p>Let’s not delete <code class="docutils literal notranslate"><span class="pre">terminator</span></code> but <code class="docutils literal notranslate"><span class="pre">gap</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;delete.f&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">deleteFeatures</span><span class="o">=</span><span class="s1">&#39;author gap&#39;</span><span class="p">,</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="id3">
<h4>Result<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TF</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">loadAll</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">makeAvailableIn</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T otype                from _temp/mudbanks.delete.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T oslots               from _temp/mudbanks.delete.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T terminator           from _temp/mudbanks.delete.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T letters              from _temp/mudbanks.delete.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T title                from _temp/mudbanks.delete.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T punc                 from _temp/mudbanks.delete.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T number               from _temp/mudbanks.delete.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levels__           from otype, oslots, otext
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __order__            from otype, oslots, __levels__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __rank__             from otype, __order__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levUp__            from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levDown__          from otype, __levUp__, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __boundary__         from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __sections__         from otype, oslots, otext, __levUp__, __levels__, title, number, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __structure__        from otype, oslots, otext, __rank__, __levUp__, title, number, number, number
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Fall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;letters&#39;, &#39;number&#39;, &#39;otype&#39;, &#39;punc&#39;, &#39;terminator&#39;, &#39;title&#39;]
</pre></div>
</div>
</div>
</div>
<p>Indeed, <code class="docutils literal notranslate"><span class="pre">gap</span></code> is gone.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">F</span><span class="o">.</span><span class="n">gap</span><span class="o">.</span><span class="n">freqList</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I told you so! Sigh ...&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>I told you so! Sigh ...
</pre></div>
</div>
</div>
</div>
<p>I told you! Sigh …</p>
</div>
</div>
<div class="section" id="add-features">
<h3>Add features<a class="headerlink" href="#add-features" title="Permalink to this headline">¶</a></h3>
<p>We add a bunch of node features and edge features.</p>
<p>When you add features, you also have to pass their data.
Here we compute that data in place, which results in a lengthy call, but usually you’ll get
that data from somewhere in a dictionary, and you only pass the dictionary.</p>
<p>We do not have to explicitly tell the value types of the new features, <code class="docutils literal notranslate"><span class="pre">modify()</span></code> will deduced them.
We can override that by passing a value type explicitly.</p>
<p>Let’s declare <code class="docutils literal notranslate"><span class="pre">lemma</span></code> to be <code class="docutils literal notranslate"><span class="pre">str</span></code>, and <code class="docutils literal notranslate"><span class="pre">big</span></code> <code class="docutils literal notranslate"><span class="pre">int</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;add.f&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">addFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">nodeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">author</span><span class="o">=</span><span class="p">{</span><span class="mi">101</span><span class="p">:</span> <span class="s1">&#39;Banks Jr.&#39;</span><span class="p">,</span> <span class="mi">102</span><span class="p">:</span> <span class="s1">&#39;Banks Sr.&#39;</span><span class="p">},</span>
      <span class="n">lemma</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
      <span class="n">small</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
      <span class="n">big</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
    <span class="p">),</span>
    <span class="n">edgeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">link</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="n">n</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)}</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)},</span>
      <span class="n">similarity</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="n">n</span> <span class="o">+</span> <span class="n">i</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)}</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)},</span>
    <span class="p">),</span>
  <span class="p">),</span>
  <span class="n">featureMeta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">lemma</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">valueType</span><span class="o">=</span><span class="s1">&#39;str&#39;</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">big</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">valueType</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">,</span>
    <span class="p">),</span>
  <span class="p">),</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |   Add features: big: feature values are declared to be int but some values are not int
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>We get away with <code class="docutils literal notranslate"><span class="pre">lemma</span></code> as string, because everything that is written is also a string.
But not all values of <code class="docutils literal notranslate"><span class="pre">big</span></code> are numbers, so: complaint.</p>
<p>Let’s stick to the default:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;add.f&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">addFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">nodeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">author</span><span class="o">=</span><span class="p">{</span><span class="mi">101</span><span class="p">:</span> <span class="s1">&#39;Banks Jr.&#39;</span><span class="p">,</span> <span class="mi">102</span><span class="p">:</span> <span class="s1">&#39;Banks Sr.&#39;</span><span class="p">},</span>
      <span class="n">lemma</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
      <span class="n">small</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
      <span class="n">big</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)},</span>
    <span class="p">),</span>
    <span class="n">edgeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">link</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="n">n</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)}</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)},</span>
      <span class="n">similarity</span><span class="o">=</span><span class="p">{</span><span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="n">n</span> <span class="o">+</span> <span class="n">i</span><span class="p">:</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">26</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)}</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">)},</span>
    <span class="p">),</span>
  <span class="p">),</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h4>Result<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TF</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">loadAll</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">makeAvailableIn</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T otype                from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T oslots               from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T terminator           from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T letters              from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T title                from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T punc                 from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T number               from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levels__           from otype, oslots, otext
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __order__            from otype, oslots, __levels__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __rank__             from otype, __order__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levUp__            from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levDown__          from otype, __levUp__, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __boundary__         from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __sections__         from otype, oslots, otext, __levUp__, __levels__, title, number, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __structure__        from otype, oslots, otext, __rank__, __levUp__, title, number, number, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T author               from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T big                  from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T gap                  from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T lemma                from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T link                 from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T similarity           from _temp/mudbanks.add.f
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T small                from _temp/mudbanks.add.f
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Fall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;author&#39;,
 &#39;big&#39;,
 &#39;gap&#39;,
 &#39;lemma&#39;,
 &#39;letters&#39;,
 &#39;number&#39;,
 &#39;otype&#39;,
 &#39;punc&#39;,
 &#39;small&#39;,
 &#39;terminator&#39;,
 &#39;title&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Eall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;link&#39;, &#39;oslots&#39;, &#39;similarity&#39;]
</pre></div>
</div>
</div>
</div>
<p>We see the extra features, and let’s just enumerate their mappings.</p>
<p><code class="docutils literal notranslate"><span class="pre">link</span></code> is an edge feature where edges do not have values.
So for each <code class="docutils literal notranslate"><span class="pre">n</span></code>, the result is a set of nodes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_items([(1, frozenset({2, 3})), (2, frozenset({3, 4})), (3, frozenset({4, 5})), (4, frozenset({5, 6})), (5, frozenset({6, 7})), (6, frozenset({8, 7})), (7, frozenset({8, 9})), (8, frozenset({9, 10})), (9, frozenset({10, 11}))])
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">similarity</span></code> assigns values to the edges. So for each <code class="docutils literal notranslate"><span class="pre">n</span></code>, the result is a mapping from nodes to values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="o">.</span><span class="n">similarity</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_items([(1, {2: &#39;c&#39;, 3: &#39;d&#39;}), (2, {3: &#39;d&#39;, 4: &#39;e&#39;}), (3, {4: &#39;e&#39;, 5: &#39;f&#39;}), (4, {5: &#39;f&#39;, 6: &#39;g&#39;}), (5, {6: &#39;g&#39;, 7: &#39;h&#39;}), (6, {7: &#39;h&#39;, 8: &#39;i&#39;}), (7, {8: &#39;i&#39;, 9: &#39;j&#39;}), (8, {9: &#39;j&#39;, 10: &#39;k&#39;}), (9, {10: &#39;k&#39;, 11: &#39;l&#39;})])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E</span><span class="o">.</span><span class="n">similarity</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((2, &#39;c&#39;), (3, &#39;d&#39;))
</pre></div>
</div>
</div>
</div>
<p>Now the node features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_items([(100, &#39;Iain M. Banks&#39;), (101, &#39;Banks Jr.&#39;), (102, &#39;Banks Sr.&#39;)])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F</span><span class="o">.</span><span class="n">small</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_items([(1, &#39;b&#39;), (2, &#39;c&#39;), (3, &#39;d&#39;), (4, &#39;e&#39;), (5, &#39;f&#39;), (6, &#39;g&#39;), (7, &#39;h&#39;), (8, &#39;i&#39;), (9, &#39;j&#39;)])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F</span><span class="o">.</span><span class="n">big</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_items([(1, &#39;B&#39;), (2, &#39;C&#39;), (3, &#39;D&#39;), (4, &#39;E&#39;), (5, &#39;F&#39;), (6, &#39;G&#39;), (7, &#39;H&#39;), (8, &#39;I&#39;), (9, &#39;J&#39;)])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">F</span><span class="o">.</span><span class="n">lemma</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_items([(1, 1001), (2, 1002), (3, 1003), (4, 1004), (5, 1005), (6, 1006), (7, 1007), (8, 1008), (9, 1009)])
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="merge-types">
<h3>Merge types<a class="headerlink" href="#merge-types" title="Permalink to this headline">¶</a></h3>
<p>Manipulating features is relatively easy. But when we fiddle with the node types, we need our wits about us.</p>
<p>In this example, we first do a feature merge of <code class="docutils literal notranslate"><span class="pre">title</span></code> and <code class="docutils literal notranslate"><span class="pre">number</span></code> into <code class="docutils literal notranslate"><span class="pre">nm</span></code>.</p>
<p>Then we merge the <code class="docutils literal notranslate"><span class="pre">line</span></code> and <code class="docutils literal notranslate"><span class="pre">sentence</span></code> types into a new type <code class="docutils literal notranslate"><span class="pre">rule</span></code>.</p>
<p>And <code class="docutils literal notranslate"><span class="pre">book</span></code> and <code class="docutils literal notranslate"><span class="pre">chapter</span></code> will merge into <code class="docutils literal notranslate"><span class="pre">section</span></code>.</p>
<p>We adapt our section structure so that it makes use of the new features and types.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;merge.t&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">mergeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">nm</span><span class="o">=</span><span class="s1">&#39;title number&#39;</span>
  <span class="p">),</span>
  <span class="n">mergeTypes</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">rule</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span>
      <span class="p">),</span>
      <span class="n">sentence</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;sentence&#39;</span><span class="p">,</span>
      <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">section</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">book</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;book&#39;</span><span class="p">,</span>
      <span class="p">),</span>
      <span class="n">chapter</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;chapter&#39;</span><span class="p">,</span>
      <span class="p">),</span>
    <span class="p">),</span>
  <span class="p">),</span>
  <span class="n">featureMeta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">otext</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">sectionTypes</span><span class="o">=</span><span class="s1">&#39;section,rule&#39;</span><span class="p">,</span>
      <span class="n">sectionFeatures</span><span class="o">=</span><span class="s1">&#39;nm,nm&#39;</span><span class="p">,</span>
      <span class="n">structureTypes</span><span class="o">=</span><span class="s1">&#39;section&#39;</span><span class="p">,</span>
      <span class="n">structureFeatures</span><span class="o">=</span><span class="s1">&#39;nm&#39;</span><span class="p">,</span>
    <span class="p">),</span>
  <span class="p">),</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="id5">
<h4>Result<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TF</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">loadAll</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">makeAvailableIn</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T otype                from _temp/mudbanks.merge.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T oslots               from _temp/mudbanks.merge.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T terminator           from _temp/mudbanks.merge.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T letters              from _temp/mudbanks.merge.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T punc                 from _temp/mudbanks.merge.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T nm                   from _temp/mudbanks.merge.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levels__           from otype, oslots, otext
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __order__            from otype, oslots, __levels__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __rank__             from otype, __order__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levUp__            from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levDown__          from otype, __levUp__, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __boundary__         from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __sections__         from otype, oslots, otext, __levUp__, __levels__, nm, nm
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __structure__        from otype, oslots, otext, __rank__, __levUp__, nm
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T author               from _temp/mudbanks.merge.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T gap                  from _temp/mudbanks.merge.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T type                 from _temp/mudbanks.merge.t
</pre></div>
</div>
</div>
</div>
<p>We expect a severy reduced inventory of node types:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((&#39;section&#39;, 66.0, 100, 102),
 (&#39;rule&#39;, 12.733333333333333, 103, 117),
 (&#39;word&#39;, 1, 1, 99))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Fall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;author&#39;, &#39;gap&#39;, &#39;letters&#39;, &#39;nm&#39;, &#39;otype&#39;, &#39;punc&#39;, &#39;terminator&#39;, &#39;type&#39;]
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="delete-types">
<h3>Delete types<a class="headerlink" href="#delete-types" title="Permalink to this headline">¶</a></h3>
<p>We delete the <code class="docutils literal notranslate"><span class="pre">line</span></code> and <code class="docutils literal notranslate"><span class="pre">sentence</span></code> types.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;delete.t&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">deleteTypes</span><span class="o">=</span><span class="s1">&#39;sentence line&#39;</span><span class="p">,</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |   Missing for text API: types: line, sentence
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>False
</pre></div>
</div>
</div>
</div>
<p>But, again, we can’t do that because they are important for the text API.</p>
<p>This time, we change the text API, so that it does not need them anymore.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;delete.t&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">deleteTypes</span><span class="o">=</span><span class="s1">&#39;sentence line&#39;</span><span class="p">,</span>
  <span class="n">featureMeta</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">otext</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">sectionTypes</span><span class="o">=</span><span class="s1">&#39;book,chapter&#39;</span><span class="p">,</span>
      <span class="n">sectionFeatures</span><span class="o">=</span><span class="s1">&#39;title,number&#39;</span><span class="p">,</span>
      <span class="n">structureTypes</span><span class="o">=</span><span class="s1">&#39;book,chapter&#39;</span><span class="p">,</span>
      <span class="n">structureFeatures</span><span class="o">=</span><span class="s1">&#39;title,number&#39;</span><span class="p">,</span>
    <span class="p">),</span>
  <span class="p">),</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h4>Result<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TF</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">loadAll</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">makeAvailableIn</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T otype                from _temp/mudbanks.delete.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T oslots               from _temp/mudbanks.delete.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T terminator           from _temp/mudbanks.delete.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T letters              from _temp/mudbanks.delete.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T title                from _temp/mudbanks.delete.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T punc                 from _temp/mudbanks.delete.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T number               from _temp/mudbanks.delete.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levels__           from otype, oslots, otext
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __order__            from otype, oslots, __levels__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __rank__             from otype, __order__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levUp__            from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levDown__          from otype, __levUp__, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __boundary__         from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __sections__         from otype, oslots, otext, __levUp__, __levels__, title, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __structure__        from otype, oslots, otext, __rank__, __levUp__, title, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T author               from _temp/mudbanks.delete.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T gap                  from _temp/mudbanks.delete.t
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((&#39;book&#39;, 99.0, 100, 100), (&#39;chapter&#39;, 49.5, 101, 102), (&#39;word&#39;, 1, 1, 99))
</pre></div>
</div>
</div>
</div>
<p>As expected.</p>
</div>
</div>
<div class="section" id="add-types">
<h3>Add types<a class="headerlink" href="#add-types" title="Permalink to this headline">¶</a></h3>
<p>Adding types involves a lot of data, because we do not only add nodes, but also features about those nodes.</p>
<p>The idea is this:</p>
<p>Suppose that somewhere in another dataset, you have found lexeme nodes for the words in your data set.</p>
<p>You just take those lexeme features, which may range from 100,000 to 110,000 say, and you find a way to map them to your
words, by means of a map <code class="docutils literal notranslate"><span class="pre">nodeSlots</span></code>.</p>
<p>Then you can just grab those lexeme functions <em>as they are</em>, and pack them into the <code class="docutils literal notranslate"><span class="pre">addTypes</span></code> argument,
together with the <code class="docutils literal notranslate"><span class="pre">nodeSlots</span></code> and the node boundaries (100,000 - 110,000).</p>
<p>The new feature data is not able to say something about nodes in the input data set, because the new nodes will be shifted
so that they are past the <code class="docutils literal notranslate"><span class="pre">maxNode</span></code> of your input data set.
And if your feature data accidentally addresses nodes outside the declared range, those assignments will be ignored.</p>
<p>So all in all, it is a rather clean addition of material.</p>
<p>Maybe a bit too clean, because it is also impossible to add edge features that link the new nodes to the old nodes.
But then, it would be devilishly hard to make sure that after the necessary remapping of the edge features,
they address the intended nodes.</p>
<p>If you do want edge features between old and new nodes, it is better to compute them in the new dataset and add them
as an individual feature or by another call to <code class="docutils literal notranslate"><span class="pre">modify()</span></code>.</p>
<p>Let’s have a look at an example where we add a type <code class="docutils literal notranslate"><span class="pre">bis</span></code> consisting of a few bigrams, and a type <code class="docutils literal notranslate"><span class="pre">tris</span></code>,
consisting of a bunch <code class="docutils literal notranslate"><span class="pre">trigrams</span></code>.</p>
<p>We just furnish a slot mapping for those nodes, and give them a <code class="docutils literal notranslate"><span class="pre">name</span></code> feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;add.t&#39;</span>
<span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="o">!</span>rm -rf <span class="o">{</span>output<span class="o">}</span>

<span class="n">modify</span><span class="p">(</span>
  <span class="n">location</span><span class="p">,</span>
  <span class="n">output</span><span class="p">,</span>
  <span class="n">addTypes</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
    <span class="n">bis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">nodeFrom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
      <span class="n">nodeTo</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
      <span class="n">nodeSlots</span><span class="o">=</span><span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">},</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">},</span>
        <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="mi">30</span><span class="p">,</span> <span class="mi">31</span><span class="p">},</span>
        <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">},</span>
        <span class="mi">5</span><span class="p">:</span> <span class="p">{</span><span class="mi">50</span><span class="p">,</span> <span class="mi">51</span><span class="p">},</span>
      <span class="p">},</span>
      <span class="n">nodeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="p">{</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;b1&#39;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;b2&#39;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;b3&#39;</span><span class="p">,</span>
          <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;b4&#39;</span><span class="p">,</span>
          <span class="mi">5</span><span class="p">:</span> <span class="s1">&#39;b5&#39;</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">),</span>
      <span class="n">edgeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">link</span><span class="o">=</span><span class="p">{</span>
          <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">2</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">25</span><span class="p">},</span>
          <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
          <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="mi">4</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">12</span><span class="p">},</span>
          <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="mi">5</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">6</span><span class="p">},</span>
          <span class="mi">5</span><span class="p">:</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
        <span class="p">},</span>
      <span class="p">),</span>
    <span class="p">),</span>
    <span class="n">tris</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
      <span class="n">nodeFrom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
      <span class="n">nodeTo</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
      <span class="n">nodeSlots</span><span class="o">=</span><span class="p">{</span>
        <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">60</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">62</span><span class="p">},</span>
        <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="mi">70</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">72</span><span class="p">},</span>
        <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">82</span><span class="p">},</span>
        <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="mi">90</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">94</span><span class="p">},</span>
      <span class="p">},</span>
      <span class="n">nodeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="p">{</span>
          <span class="mi">1</span><span class="p">:</span> <span class="s1">&#39;tr1&#39;</span><span class="p">,</span>
          <span class="mi">2</span><span class="p">:</span> <span class="s1">&#39;tr2&#39;</span><span class="p">,</span>
          <span class="mi">3</span><span class="p">:</span> <span class="s1">&#39;tr3&#39;</span><span class="p">,</span>
          <span class="mi">4</span><span class="p">:</span> <span class="s1">&#39;tr4&#39;</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="p">),</span>
      <span class="n">edgeFeatures</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">sim</span><span class="o">=</span><span class="p">{</span>
          <span class="mi">1</span><span class="p">:</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
          <span class="mi">2</span><span class="p">:</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
          <span class="mi">3</span><span class="p">:</span> <span class="p">{</span><span class="mi">4</span><span class="p">},</span>
          <span class="mi">4</span><span class="p">:</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
        <span class="p">},</span>
      <span class="p">),</span>
    <span class="p">),</span>
  <span class="p">),</span>
  <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="section" id="id7">
<h4>Result<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">TF</span> <span class="o">=</span> <span class="n">Fabric</span><span class="p">(</span><span class="n">locations</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">MODIFIED</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">test</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">TF</span><span class="o">.</span><span class="n">loadAll</span><span class="p">(</span><span class="n">silent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">docs</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">makeAvailableIn</span><span class="p">(</span><span class="nb">globals</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T otype                from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T oslots               from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T terminator           from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T letters              from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T title                from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T punc                 from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T number               from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levels__           from otype, oslots, otext
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __order__            from otype, oslots, __levels__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __rank__             from otype, __order__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levUp__            from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __levDown__          from otype, __levUp__, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __boundary__         from otype, oslots, __rank__
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __sections__         from otype, oslots, otext, __levUp__, __levels__, title, number, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |      |     0.00s C __structure__        from otype, oslots, otext, __rank__, __levUp__, title, number, number, number
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T author               from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T gap                  from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T link                 from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T name                 from _temp/mudbanks.add.t
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   |     0.00s T sim                  from _temp/mudbanks.add.t
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">C</span><span class="o">.</span><span class="n">levels</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>((&#39;book&#39;, 99.0, 100, 100),
 (&#39;chapter&#39;, 49.5, 101, 102),
 (&#39;sentence&#39;, 33.0, 115, 117),
 (&#39;line&#39;, 7.666666666666667, 103, 114),
 (&#39;tris&#39;, 3.0, 123, 126),
 (&#39;bis&#39;, 2.0, 118, 122),
 (&#39;word&#39;, 1, 1, 99))
</pre></div>
</div>
</div>
</div>
<p>There are the <code class="docutils literal notranslate"><span class="pre">bis</span></code> and <code class="docutils literal notranslate"><span class="pre">tris</span></code>!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Fall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;author&#39;,
 &#39;gap&#39;,
 &#39;letters&#39;,
 &#39;name&#39;,
 &#39;number&#39;,
 &#39;otype&#39;,
 &#39;punc&#39;,
 &#39;terminator&#39;,
 &#39;title&#39;]
</pre></div>
</div>
</div>
</div>
<p>And there is the new feature <code class="docutils literal notranslate"><span class="pre">name</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sorted</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(118, &#39;b1&#39;),
 (119, &#39;b2&#39;),
 (120, &#39;b3&#39;),
 (121, &#39;b4&#39;),
 (122, &#39;b5&#39;),
 (123, &#39;tr1&#39;),
 (124, &#39;tr2&#39;),
 (125, &#39;tr3&#39;),
 (126, &#39;tr4&#39;)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Eall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;link&#39;, &#39;oslots&#39;, &#39;sim&#39;]
</pre></div>
</div>
</div>
</div>
<p>And the new edge features <code class="docutils literal notranslate"><span class="pre">link</span></code> and <code class="docutils literal notranslate"><span class="pre">sim</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sorted</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">link</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(118, {121: &#39;25&#39;, 120: &#39;50&#39;, 119: &#39;100&#39;}),
 (119, {122: &#39;12&#39;, 121: &#39;25&#39;, 120: &#39;50&#39;}),
 (120, {122: &#39;12&#39;, 121: &#39;25&#39;}),
 (121, {118: &#39;6&#39;, 122: &#39;12&#39;}),
 (122, {121: &#39;1&#39;, 119: &#39;3&#39;, 118: &#39;6&#39;})]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">sorted</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">sim</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(123, frozenset({124, 125, 126})),
 (124, frozenset({125, 126})),
 (125, frozenset({126})),
 (126, frozenset({123}))]
</pre></div>
</div>
</div>
</div>
<p>And that is all for now.</p>
<p>Incredible that you made it till here!</p>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./banks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../intro.html" title="previous page">Introduction</a>
    <a class='right-next' id="next-link" href="app.html" title="next page">The Banks example corpus as app</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Dirk Roorda<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    
  </body>
</html>